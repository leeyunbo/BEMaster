# HTTP 헤더 
## HTTP 헤더 개요 
#### HTTP 헤더 용도 
* HTTP 전송에 필요한 모든 부가정보 
* 메시지 바디의 내용, 크기, 압축, 인증, … 등등 

### HTTP - RFC2616 
#### 1. RFC2616(과거) 헤더 분류
* General 헤더 : 전체에 적용 (Connection: close) 
* Request 헤더 : 요청 정보 (User-Agent:..)
* Response 헤더 :응답 정보 (Server: Apache)
* Entity 헤더  : 엔티티 바디 정보 (Content-Type: text/html..) 

#### 2. HTTP 헤더 - RFC2616(과거) 메시지 바디 
* 메시지 본문은 Entity 본문을 전달하는데 사용 
* Entity 본문은 전달될 실제 데이터 
* Entity 헤더는 본문을 해석할 수 있는 정보 제공 (html, json, 데이터 길이, 압축 정보) 

### RFC2616의 폐기, RFC7230 - 7235 등장 
#### 1. RFC7230 - 메시지 바디 
* 메시지 본문을 통해 표현(Entity -> Representation) 데이터 전달
* 메시지 본문 = payload
* 표현 = 실제 데이터 
* 표현 헤더는 표현 데이터를 해석할 수 있는 정보를 제공 

#### 2. 왜 표현으로 바뀌었을까? 
* 회원이라는 리소스를 요청하면 JSON이나 HTML, XML로 리소스를 표현하여 응답한다.
* 이래서 표현이라는 용어로 변경함 

<br/>

## 표현 
### 표현 헤더 
#### 1. 표현 헤더의 종류 
* Content-Type : 어떻게 표현할 것인지
* Content-Encoding : 어떻게 압축했는지
* Content-Language : 표현 데이터의 자연 언어 (영어, 한국어..?) 
* Content-Length : 표현 데이터의 길이 

#### 2. Content-Type 
* 바디에 들어가는 내용이 뭐야? 

#### 3. Content-Encoding 
* 표현 데이터를 압축하기 위해 사용
* 전달하는 곳에서 바디를 압축, 받는 곳에서 압축 해제 
* gzip, deflate, identity(압축 안한다는 뜻)  

#### 4. Content-Language  
* 표현 데이터의 자연 언어를 표현
* ko, en, en-US 

#### 5. Content-Length 
* 바이트 단위 
* Transfer-Encoding을 사용하면 사용하면 안됨  

<br/>

## 협상(콘텐츠 네고시에이션) 
### 클라이언트가 선호하는 표현으로 요청
* Accept : 이 미디어 타입 주세요
* Accept-Charset : 이 문자 인코딩 주세요 
* Accept-Encoding : 이 압축 인코딩으로 주세요
* Accept-Language : 이 자연 언어로 주세요  

### Accept-Language 
#### 1. Accept-Language 적용 전,후  
* 적용 전에는 서버는 클라이언트 요청에 대하여 무조건 기본 자연 언어로 응답함 
* 왜냐, 클라이언트가 어떤 자연 언어를 사용하는지 모르니까 
* 적용 후에는 클라이언트가 원하는 언어로 응답해줄 수 있음

#### 2. 협상과 우선순위 - Quality-Values(q) 
* 0~1, 클수록 높은 우선순위 
* 생략하면 1
* Accept-Language: ko-KR, ko;q=0.9, en-US;q=0.8,en;q=0.7 
* ko-KR이 없네? 그러면 ko. 
* ko가 없네? 그럼 en-US 

#### 3. 협상과 우선순위 2 - Quality-Values(q) 
* 구체적인 것이 우선한다. 
* Accept: text/*, text/plain 
-> text/plain이 우선임 

<br/>

## 전송 방식 
### 전송 방식 설명 
* 단순 전송
* 압축 전송
* 분할 전송 
* 뻠위 전송

#### 1. 단순 전송 - Content-Length
* Content-Length  : 단순히 진짜 길이를 설정함 
* 한번에 쭈우우욱 받는 방식이기에 단순 방식 

#### 2. 압축 전송 - Content-Encoding 
#### 3. 분할 전송 - Transfer-Encoding
* Transfer-Encoding: chunked -> 덩어리로 쪼개서 보냄 
* 용량이 큰 경우 분할해서 보내면 오는대로 표현할 수 있어서 좋을수도 있음 
* Content-Length를 넣으면 안됨, 분할될 때 바이트 정보가 다 들어가있기 때문에 X 

#### 4. 범위 전송 - Content-Range. 
* 바이트의 범위를 지정하여 바디의 일정부분부터 일정부분까지 전송 가능 
* 긴 바디를 한번에 보내다가 끊기면? 처음부터 다시보내면 아쉽. 

<br/>

## 일반 정보 
#### 1. From - 유저 에이전트의 이메일 정보 
* 일반적으로 잘 사용되지 않음 

#### 2. Referer - 이전 웹 페이지 주소
* 현재 요청된 페이지의 이전 요청 페이지 주소
* 많이 사용됨! 
* 유입 경로 분석이 가능하다.  (내 페이지를 어디서 많이 들어왔을까?)
* 참고로 Referrer의 오타.. 

#### 4. User-Agent 
* 클라이언트의 웹 브라우저 정보
* 어떤 종류의 브라우저에서 장애가 발생하는지 파악 가능 

#### 5. Server
* 요청을 처리하는 ORIGIN 서버의 소프트웨어 정보 
* 보통 요청을 보내면 여러 프록시 서버를 거치게 됨
* 실제로 요청에 응답을 해주는 서버를 ORIGIN 서버라고 한다. 

#### 6. Date 
* 메시지가 발생한 날짜와 시간 
* 응답에서 사용됨 

<br/>

## 특별한 정보 
#### 1. Host - 요청한 호스트 정보(도메인) 
* 요청에서 사용되며 필수값임 
* 하나의 서버가 여러 도메인을 처리해야할 때 
* 하나의 IP 주소에 여러 도메인이 지정되어 있을 때  
* 한 IP에 여러 애플리케이션이 구동되는 경우? -> 호스트 정보를 같이 포함시켜 요청하여 서버가 요청을 구분할 수 있도록 하게 함 (IP로만 통신하기 때문)  (가상 호스팅) 

#### 2. Location - 페이지 리다이렉션 
* 300대 응답 결과에 Location이 있으면 자동 리다이렉션 
* 201(Created) : 생성된 리소스 URI
 
#### 3. Allow - 허용 가능한 HTTP 메서드 
* 405 (Method Not Allowed) 에서 응답에 포함해야함 
* Allow: GET, HEAD, PUT
* 많이 사용하진 않음 

#### 4. Retry-After  
* 503 : 서비스가 언제까지 불능인지 알려줄 수 있음

<br/>

## 인증 
#### 1. Authorization  - 클라이언트 인증 정보를 서버에 전달 
#### 2. WWW-Authenticate - 리소스 접근시 필요한 인증 방법 정의 
* 401 Unauthorized 응답과 함께 사용 

<br/>

## 쿠키 
#### 1. 쿠키의 대표 헤더 
* Set-Cookie : 서버에서 클라로 쿠키 전달 
* Cookie: 클라이언트가 서버에서 받은 쿠키를 저장하고, HTTP 요청시 서버로 전달 

#### 2. 쿠키 미사용 (로그인) 
* 모든 요청과 링크에 사용자 정보를 포함
* 모든 요청에 사용자 정보가 포함되도록 개발해야함 
* 브라우저를 종료후 오픈하게 되면? 

#### 3. 쿠키 사용 (로그인) 
![image](https://user-images.githubusercontent.com/44944031/110951042-f047e800-8387-11eb-83a7-0aee4a5438b8.png)


* 클라이언트는 쿠키 저장소에 쿠키를 저장해놓음 
* 그 다음 요청에서부터 자동으로 쿠키 저장소를 뒤져서 쿠키를 가져와 요청에 포함시킴 
* 즉, 모든 요청에 쿠키 정보가 자동으로 포함된다. 
* 그런데 모든 요청에 쿠키 정보를 포함하면 보안적으로 문제가 발생할 수 있음 
-> 로그인 시 서버에서 세션 아이디를 생성하여 DB에 저장 해놓고 클라이언트에게 반환
-> 클라이언트는 쿠키 저장소에 세션 아이디를 저장해놓고 요청시 포함하여 전송.
-> 서버는 해당 세션 아이디를 이용하여 세션 정보를 활용한다. 

#### 4. 쿠키에 대하여 
* 사용처 : 로그인 세션 관리, 광고 정보 트래킹 
* 쿠키 정보는 항상 서버에 전송되어 트래픽 유발함, 따라서 최소한의 정보만 사용(세션 id, 인증 토큰) 
* 웹 브라우저 내부에 데이터를 저장하는 방식은 웹 스토리지 참고 
* 보안에 민감한 데이터는 저장 X 

#### 5. 쿠키의 생명주기 
* Set-Cookie: expires=만료일 
* Set-Cookie: max-age=초단위 
* 세션쿠키 : 만료 날짜를 생략하면 브라우저 종료시 까지만 유지
* 영속쿠키 : 만료 날짜를 입력하면 해당 날짜까지 유지 

#### 6. 쿠키의 도메인 
* 아무 사이트나 가서 쿠키가 사용되면 안됨! 
* domain=지정url 

#### 7. 쿠키 - 경로 
* 이 경로를 포함한 하위 경로 페이지만 쿠키 접근 
* path=/home
* 일반적으로 루트 url로 지정한다. 왜냐 한 페이지에서 다 쓰잖아! 
* path=/home -> /home/… 다 가능! 

#### 8. 쿠키 - 보안 
* Secure : Seucre를 적용하면 https인 경우에만 쿠키 전송 
* HttpOnly : XSS 공격 방지, 자바스크립트에서 쿠키 접근 불가, HTTP 전송에서만 사용 
